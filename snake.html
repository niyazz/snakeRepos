<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>The Snake Game</title>
	<style>
		canvas{
		background-color:#d9b3ff;
	}
	</style>
</head>
<body>
	<canvas id = "myCanvas"width ="800" height="500">		
	</canvas>
    
	<script type="text/javascript">

		document.addEventListener("keydown", keyDownHandler, false);
     	document.addEventListener("keyup", keyUpHandler, false);

     //for second commit


		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");

		var rightPressed = false;
		var leftPressed = false;
		var upPressed = false;
		var downPressed = false;

		var snakeX = canvas.width/2;
		var snakeY = canvas.height/2;
		var snakeWidth = 20;
		var snakeHeight = 20;
		var snakeSpeed = 3;
		var sVelX = 0;
		var sVelY = 0;
		var snakeTail = [];

		var snakeMaxTail = 100;

		var appleAmount = 3;
		var apples = [];
		var appleWidth = 20;
		var appleHeight = 20;
		var applesGone = true;
		var curAX = [];
		var curAY = [];
		var count = 0;
		
          for(var  i = 0; i< appleAmount; i++){
            	apples[i] = {x:0, y:0, live: true};
            }



        function appleSpawner(){
          ctx.fillStyle = "lime"     
            
          

           for(var i=0; i< appleAmount ;i++){ 

           /*if(apples[i].live == false){
               count++;
               if(count>=3) {applesGone = true;count = 0;}
            } */    
            

            if(applesGone){
            apples[i].live = true;
         	apples[i].x= Math.floor(Math.random() * (800 - 0 + 1)) + 0;
         	apples[i].y= Math.floor(Math.random() * (500 - 0 + 1)) + 0;   
            curAX[i] = apples[i].x;            
            curAY[i] = apples[i].y;
            console.log("Apple " + i +" x = " +curAX[i] + "y = "+ curAY[i]);

         	}

         	if(!applesGone){
         	apples[i].x=curAX[i];
         	apples[i].y=curAY[i];
         	}  

         	if(apples[i].live){
            ctx.rect(apples[i].x, apples[i].y, appleWidth, appleHeight);
            ctx.fill();
        }
        }
        for(var i=0; i<appleAmount;i++){
        	if(apples[i].live) count++;
        }
        if(count>=1){
        applesGone = false; count =0;
    }
        else {applesGone = true; console.log("яблоки кончились") }
    }
     
        
        

        function collisionTail(){
        	for(var i=0;i< appleAmount; i++){
        		var a = apples[i];
        		if((snakeX + snakeWidth > a.x) && snakeX < a.x+appleWidth && (snakeY + snakeHeight) > a.y && snakeY < a.y+appleHeight) {
        			apples[i].live = false;
        		}
        	}

        }

		function drawSnake(){
			
			ctx.beginPath();
			
			ctx.fillStyle = "black";
            
            for(var i=0; i<snakeTail.length;i++){
     
	        ctx.fillRect(snakeTail[i].x, snakeTail[i].y, snakeWidth, snakeHeight);
	      

	    }
             

            snakeTail.push({x: snakeX, y: snakeY, color: ctx.fillStyle });
        
			ctx.fill();

            
			if( snakeTail.length > snakeMaxTail )
           {           	
               snakeTail.shift();
           }
			ctx.closePath();	
			snakeX+=sVelX;
			snakeY+=sVelY;
             }

		

        function draw()
        {
          ctx.clearRect(0,0, canvas.width, canvas.height);
          
          appleSpawner();
          drawSnake();
          collisionTail();

          
          
          
          
          

            if(upPressed &&!downPressed && !leftPressed && !rightPressed){
            	  sVelY=-snakeSpeed;   
            	  sVelX=0;           
            }
            if(downPressed && !upPressed && !leftPressed && !rightPressed ){
            	    sVelY=+snakeSpeed;   
            	    sVelX=0;     	
            }
            if(leftPressed && !rightPressed && !upPressed && !downPressed){
            	sVelX=-snakeSpeed;
            	sVelY=0;
            }
            if(rightPressed && !leftPressed && !upPressed && !downPressed){
            	sVelX=+snakeSpeed;
            	sVelY=0;
            }
            if(snakeX > canvas.width) {snakeX = 2;console.log("уперлась вправо");}

            if(snakeX < 0) {snakeX = canvas.width;console.log("уперлась влево");}

            if(snakeY > canvas.height) {snakeY = 2;console.log("уперлась вниз");}

            if(snakeY < 0) {snakeY = canvas.height;console.log("уперлась вверх");}


        }
        

        function keyDownHandler(e){
            switch(e.key)
            {          	
            	case "ArrowRight": rightPressed = true; break;
            	case "ArrowLeft": leftPressed = true; break;
            	case "ArrowUp": upPressed = true; break;
            	case "ArrowDown": downPressed = true; break;      
            }
        }




         function keyUpHandler(e){
            switch(e.key)
            {          	
            	case "ArrowRight": rightPressed = false; break;
            	case "ArrowLeft": leftPressed = false; break;
            	case "ArrowUp": upPressed = false; break;
            	case "ArrowDown": downPressed = false; break;      
            }
        }
           
            setInterval(draw, 10);
     		
     		
	</script>;;


</body>
</html>
